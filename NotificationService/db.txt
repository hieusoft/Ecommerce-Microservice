CREATE TABLE DeliveryMethods (
    DeliveryMethodId INT PRIMARY KEY IDENTITY(1,1),
    Name NVARCHAR(50) NOT NULL,       -- Email, InApp, Push, SMS...
    Description NVARCHAR(255) NULL    -- Mô tả kênh gửi
);

-- Ví dụ dữ liệu
INSERT INTO DeliveryMethods (Name, Description)
VALUES
('Email', 'Gửi email tới user'),
('InApp', 'Hiển thị trong website'),
('Push', 'Thông báo push mobile'),
('SMS', 'Gửi tin nhắn SMS');

CREATE TABLE Notifications (
    NotificationId INT PRIMARY KEY IDENTITY(1,1),
    Title NVARCHAR(255) NOT NULL,
    Content NVARCHAR(MAX) NOT NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),   -- Thời điểm tạo
    UpdatedAt DATETIME2 NULL,                             -- Thời điểm update
    CreatedBy INT NULL,                                   -- Admin tạo hay hệ thống
    IsBroadcast BIT NOT NULL DEFAULT 0                   -- Broadcast hay không
);



CREATE TABLE NotificationDelivery (
    NotificationDeliveryId INT PRIMARY KEY IDENTITY(1,1),
    NotificationId INT NOT NULL,
    UserId INT NOT NULL,
    DeliveryMethodId INT NOT NULL,   
    Status INT NOT NULL DEFAULT 0,   -- 0 = Unread, 1 = Read
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),   -- Thời điểm tạo
    UpdatedAt DATETIME2 NULL,              -- thời điểm gửi (Email/InApp)
    ReadAt DATETIME2 NULL,           -- thời điểm user đọc
    Metadata NVARCHAR(MAX) NULL,     -- JSON log: retry, lỗi gửi...

    CONSTRAINT FK_NotificationDelivery_Notification
        FOREIGN KEY (NotificationId)
        REFERENCES Notifications(NotificationId)
        ON DELETE CASCADE,

    CONSTRAINT FK_NotificationDelivery_DeliveryMethod
        FOREIGN KEY (DeliveryMethodId)
        REFERENCES DeliveryMethods(DeliveryMethodId)
);

CREATE TABLE UserCache (
    UserId INT IDENTITY(1,1) PRIMARY KEY,
    FullName NVARCHAR(150) NULL,
    Username NVARCHAR(100) NOT NULL UNIQUE,
    Email NVARCHAR(100) NOT NULL UNIQUE,
    UpdatedAt DATETIME2 DEFAULT GETDATE()
);

